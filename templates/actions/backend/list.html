<div class="block">
    <h1>AnonGuard</h1>
    <p>{$message}</p>

    <form id="depersonalizer-form" method="post">
        <div class="field">
            <div class="name"><label for="days">{_wp('Retention days')}</label></div>
            <div class="value">{$fields.days}</div>
        </div>
        <div class="field">
            <div class="value"><label>{$fields.keep_geo} {_wp('Keep geo statistics')}</label></div>
        </div>
        <div class="field">
            <div class="value"><label>{$fields.wipe_comments} {_wp('Wipe order comments')}</label></div>
        </div>
        <div class="field">
            <div class="value"><label>{$fields.anonymize_contact_id} {_wp('Replace contact_id with anonymous contact')}</label></div>
        </div>
        {$wa->csrf()}
        <div class="field">
            <div class="value">
                <button type="button" class="preview btn">{_wp('Preview')}</button>
                <button type="button" class="run btn green">{_wp('Run')}</button>
            </div>
        </div>
    </form>

    <div id="depersonalizer-output"></div>
</div>

<script type="text/javascript">
(function($) {
    var form = $('#depersonalizer-form');
    var output = $('#depersonalizer-output');
    function preview() {
        $.post('?plugin=depersonalizer&module=run&action=preview', form.serialize(), function(resp) {
            if (resp && resp.data && resp.data.message) {
                output.text(resp.data.message);
            } else if (resp && resp.message) {
                output.text(resp.message);
            } else {
                output.text(resp.error || '');
            }
        }, 'json');
    }
    form.find('.preview').on('click', preview);
    form.find('.run').on('click', function() {
        output.load('?plugin=depersonalizer&action=run', form.serialize());
    });
})(jQuery);
</script>
